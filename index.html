<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„å…¨èƒ½é£²é£Ÿè¨ˆç®—å™¨ Pro</title>
    <style>
        :root { --primary: #008037; --bg: #f5f7f5; --card: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #333; }
        .container { max-width: 500px; margin: 0 auto; }
        .main-card { background: var(--card); padding: 25px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); margin-bottom: 20px; position: relative; }
        #searchWrapper { position: relative; }
        #results { position: absolute; width: 100%; background: white; border: 1px solid #ddd; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); z-index: 999; max-height: 250px; overflow-y: auto; display: none; margin-top: -10px; }
        .res-item { padding: 14px; border-bottom: 1px solid #f0f0f0; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .res-item:hover { background: #f0fdf4; color: var(--primary); font-weight: bold; }
        .brand-label { font-size: 10px; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; }
        input, select { width: 100%; border: 2px solid #eee; border-radius: 12px; padding: 14px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px; }
        .scale-box { background: #fffcf0; padding: 15px; border-radius: 15px; border: 1px solid #ffe58f; margin-bottom: 15px; display: none; }
        .num-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .num-grid label { font-size: 11px; color: #888; margin-bottom: 4px; display: block; }
        .add-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 16px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 12px; border-radius: 15px; text-align: center; border-top: 4px solid #ff8200; }
        .log-item { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <header><h1 style="text-align:center; color:var(--primary); font-size: 24px;">ğŸ¥— å…¨èƒ½é£²é£Ÿè¨ˆç®—å™¨ Pro</h1></header>

    <div class="dashboard">
        <div class="stat-card"><span>ç†±é‡</span><span id="t-cal" style="display:block; font-weight:800; color:var(--primary);">0</span></div>
        <div class="stat-card"><span>è›‹ç™½</span><span id="t-pro" style="display:block; font-weight:800; color:var(--primary);">0</span></div>
        <div class="stat-card"><span>ç¢³æ°´</span><span id="t-carb" style="display:block; font-weight:800; color:var(--primary);">0</span></div>
    </div>

    <div class="main-card">
        <div id="searchWrapper">
            <label style="font-weight:bold; color:var(--primary);">ğŸ” æ™ºèƒ½æœå°‹é£Ÿç‰©/å“ç‰Œ</label>
            <input type="text" id="fName" oninput="doSearch()" placeholder="è©¦è©¦è¼¸å…¥ï¼šé£¯ã€å¤§éº¥å…‹ã€æ‹¿éµ..." autocomplete="off">
            <div id="results"></div>
        </div>

        <div id="scaleZone" class="scale-box">
            <label id="scaleLabel" style="font-weight:bold; font-size:14px;">ä»½é‡èª¿æ•´</label>
            <div style="display:flex; gap:10px;">
                <select id="unitType" onchange="reCalc()" style="flex:1;"><option value="g">å…¬å…‹ (g)</option></select>
                <input type="number" id="weightInput" oninput="reCalc()" value="100" style="flex:1;">
            </div>
        </div>

        <div class="num-grid">
            <div><label>ç†±é‡</label><input type="number" id="c-cal"></div>
            <div><label>è›‹ç™½</label><input type="number" id="c-pro"></div>
            <div><label>ç¢³æ°´</label><input type="number" id="c-carb"></div>
        </div>
        <button class="add-btn" onclick="save()">åŠ å…¥ä»Šæ—¥ç´€éŒ„</button>
    </div>
    <div id="logs"></div>
</div>

<script>
    const db = {
        // --- é£¯é¡ (ä»¥100gåŸºæº–) ---
        "ç™½é£¯": {cal: 130, pro: 2.7, carb: 28, u: "rice", b: "ä¸»é£Ÿ"},
        "ç³™ç±³é£¯": {cal: 111, pro: 2.6, carb: 23.5, u: "rice", b: "ä¸»é£Ÿ"},
        "é»‘ç±³é£¯": {cal: 146, pro: 3.5, carb: 30, u: "rice", b: "ä¸»é£Ÿ"},
        
        // --- éº¥ç•¶å‹ ---
        "éº¥ç•¶å‹-å¤§éº¥å…‹": {cal: 548, pro: 26, carb: 46, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-ä¸­è–¯": {cal: 376, pro: 4, carb: 45, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-å¤§è–¯": {cal: 529, pro: 6, carb: 63, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-6å¡Šé›å¡Š": {cal: 270, pro: 15, carb: 14, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-è±¬è‚‰æ»¿ç¦å ¡åŠ è›‹": {cal: 427, pro: 21, carb: 29, u: "f", b: "éº¥ç•¶å‹"},
        "éº¥ç•¶å‹-å¥§åˆ©å¥§å†°ç‚«é¢¨": {cal: 352, pro: 6, carb: 55, u: "f", b: "éº¥ç•¶å‹"},

        // --- æ˜Ÿå·´å…‹ ---
        "æ˜Ÿå·´å…‹-é‚£å ¤(ä¸­)": {cal: 150, pro: 8, carb: 13, u: "f", b: "æ˜Ÿå·´å…‹"},
        "æ˜Ÿå·´å…‹-èµ·å¸ç‰›è‚‰å¯é Œ": {cal: 420, pro: 18, carb: 32, u: "f", b: "æ˜Ÿå·´å…‹"},
        "æ˜Ÿå·´å…‹-ç¶­ä¹Ÿç´é¢¨è»Ÿæ³•": {cal: 320, pro: 10, carb: 45, u: "f", b: "æ˜Ÿå·´å…‹"},

        // --- è¶…å•† ---
        "7-11-é®ªé­šå¾¡é£¯ç³°": {cal: 195, pro: 4.8, carb: 35, u: "f", b: "7-11"},
        "7-11-è‚‰é¬†å¾¡é£¯ç³°": {cal: 215, pro: 4.5, carb: 41, u: "f", b: "7-11"},
        "7-11-é›èƒ¸è‚‰": {cal: 115, pro: 22.5, carb: 1, u: "f", b: "7-11"},
        "å…¨å®¶-é›èƒ¸è‚‰": {cal: 104, pro: 22.1, carb: 0.8, u: "f", b: "å…¨å®¶"},
        "å…¨å®¶-èŒ¶è‘‰è›‹": {cal: 75, pro: 7, carb: 1, u: "f", b: "å…¨å®¶"},
        "å…¨å®¶-å¤¯ç•ªè–¯": {cal: 124, pro: 1.2, carb: 28, u: "g", b: "å…¨å®¶"},

        // --- å…¶ä»–é€£é– ---
        "å…«æ–¹é›²é›†-æ‹›ç‰Œé‹è²¼": {cal: 65, pro: 2.5, carb: 7, u: "f", b: "å…«æ–¹"},
        "å…«æ–¹é›²é›†-æ‹›ç‰Œæ°´é¤ƒ": {cal: 55, pro: 2.5, carb: 6, u: "f", b: "å…«æ–¹"},
        "è—å£½å¸-ç†Ÿæˆé®ªé­š": {cal: 80, pro: 5, carb: 12, u: "f", b: "è—å£½å¸"},
        "å°Gåº—-è’œé ­é›æ¹¯": {cal: 420, pro: 38, carb: 8, u: "f", b: "å°Gåº—"},
        
        // --- åŸºç¤é£Ÿæ (ä»¥100gåŸºæº–) ---
        "é¦™è•‰": {cal: 90, pro: 1.1, carb: 23, u: "g", b: "æ°´æœ"},
        "è˜‹æœ": {cal: 52, pro: 0.3, carb: 14, u: "g", b: "æ°´æœ"},
        "é›è›‹(å¤§)": {cal: 75, pro: 7, carb: 1, u: "f", b: "è›‹é¡"}
    };

    let selected = null;
    let history = JSON.parse(localStorage.getItem('diet_final_v12')) || [];

    function doSearch() {
        const v = document.getElementById('fName').value.toLowerCase();
        const resDiv = document.getElementById('results');
        if(!v) { resDiv.style.display = 'none'; return; }
        let m = Object.keys(db).filter(k => k.toLowerCase().includes(v));
        if(m.length > 0) {
            resDiv.innerHTML = m.map(k => `<div class="res-item" onclick="selectItem('${k}')"><span>${k}</span><span class="brand-label">${db[k].b}</span></div>`).join('');
            resDiv.style.display = 'block';
        } else { resDiv.style.display = 'none'; }
    }

    function selectItem(name) {
        selected = { name, ...db[name] };
        document.getElementById('fName').value = name;
        document.getElementById('results').style.display = 'none';
        const zone = document.getElementById('scaleZone');
        const unit = document.getElementById('unitType');
        
        if(selected.u === "rice") {
            zone.style.display = 'block';
            unit.innerHTML = `<option value="bowl">ç¢— (æ¨™æº–)</option><option value="g">å…¬å…‹ (g)</option>`;
            document.getElementById('weightInput').value = 1;
        } else if(selected.u === "g") {
            zone.style.display = 'block';
            unit.innerHTML = `<option value="g">å…¬å…‹ (g)</option>`;
            document.getElementById('weightInput').value = 100;
        } else { zone.style.display = 'none'; }
        reCalc();
    }

    function reCalc() {
        if(!selected) return;
        const v = parseFloat(document.getElementById('weightInput').value) || 0;
        const ut = document.getElementById('unitType').value;
        let r = (ut === "bowl") ? (v * 160) / 100 : v / 100;
        document.getElementById('c-cal').value = (selected.cal * r).toFixed(1);
        document.getElementById('c-pro').value = (selected.pro * r).toFixed(1);
        document.getElementById('c-carb').value = (selected.carb * r).toFixed(1);
    }

    function save() {
        const name = document.getElementById('fName').value;
        if (!name) return;
        history.push({
            name, 
            cal: parseFloat(document.getElementById('c-cal').value), 
            pro: parseFloat(document.getElementById('c-pro').value), 
            carb: parseFloat(document.getElementById('c-carb').value)
        });
        localStorage.setItem('diet_final_v12', JSON.stringify(history));
        update();
        document.getElementById('fName').value = '';
        document.getElementById('scaleZone').style.display = 'none';
    }

    function update() {
        const list = document.getElementById('logs'); list.innerHTML = '';
        let tc=0, tp=0, tb=0;
        history.forEach((item, i) => {
            tc += item.cal; tp += item.pro; tb += item.carb;
            list.innerHTML += `<div class="log-item"><div><b>${item.name}</b><br><small>${item.cal}å¡ | è›‹ ${item.pro}g</small></div><div style="color:#ff4d4f; font-weight:bold; cursor:pointer;" onclick="del(${i})">Ã—</div></div>`;
        });
        document.getElementById('t-cal').innerText = Math.round(tc);
        document.getElementById('t-pro').innerText = tp.toFixed(1);
        document.getElementById('t-carb').innerText = tb.toFixed(1);
    }

    function del(i) { history.splice(i,1); localStorage.setItem('diet_final_v12', JSON.stringify(history)); update(); }
    window.onload = update;
</script>
</body>
</html>

